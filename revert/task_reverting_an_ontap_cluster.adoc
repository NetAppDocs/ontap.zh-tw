---
permalink: revert/task_reverting_an_ontap_cluster.html 
sidebar: sidebar 
keywords: ontap, revert, reverting, reversion, cluster 
summary: 若要讓叢集離線以恢復至先前ONTAP 版本的版本、您必須停用儲存容錯移轉和資料生命週期、設定還原先決條件、還原節點上的叢集和檔案系統組態、然後針對叢集中的每個額外節點重複此程序。 
---
= 還原ONTAP 整個叢集
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
若要讓叢集離線以恢復至先前ONTAP 版本的版本、您必須停用儲存容錯移轉和資料生命週期、設定還原先決條件、還原節點上的叢集和檔案系統組態、然後針對叢集中的每個額外節點重複此程序。

您必須已完成回復 link:task_things_to_verify_before_revert.html["驗證"] 和 link:concept_pre_revert_checks.html["預先檢查"]。

還原叢集需要在還原期間讓叢集離線。

. 將權限等級設為進階、並在系統提示您繼續時輸入* y*：「et -priv
+
出現進階提示（「*>」）。

. 驗證是否ONTAP 安裝目標版的圖形軟體：「System image show」（系統映像顯示）
+
下列範例顯示9.1版已安裝為兩個節點的替代映像：

+
[listing]
----
cluster1::*> system image show
                 Is      Is                 Install
Node     Image   Default Current Version    Date
-------- ------- ------- ------- --------   -------------------
node0
         image1  true    true    9.2        MM/DD/YYYY TIME
         image2  false   false   9.1        MM/DD/YYYY TIME
node1
         image1  true    true    9.2        MM/DD/YYYY TIME
         image2  false   false   9.1        MM/DD/YYYY TIME
4 entries were displayed.
----
. 停用叢集中的所有資料LIF：「網路介面修改｛-role data｝-STATUS-admin down」
. [[ste-5]]如果叢集僅包含兩個節點、請停用叢集HA：「叢集HA modify -configured假」
. [[dro步驟6]]停用HA配對中任一節點的儲存容錯移轉：「torage容錯移轉修改節點節點節點節點名稱-啟用假」
+
HA配對只需停用一次儲存容錯移轉。當您停用節點的儲存容錯移轉時、節點的合作夥伴也會停用儲存容錯移轉。

. 登入您要還原的節點。
+
若要還原節點、您必須透過節點的節點管理LIF登入叢集。

. 將節點的目標ONTAP Isfetical軟體映像設為預設映像：「System image modify -nodame -image target -IsDefault true」
. 驗證目標ONTAP 的物件不全軟體映像是否設為您要還原之節點的預設映像：「System image show」（系統映像顯示）
+
以下範例顯示9.1版已設定為節點0上的預設映像：

+
[listing]
----
cluster1::*> system image show
                 Is      Is                 Install
Node     Image   Default Current Version    Date
-------- ------- ------- ------- --------   -------------------
node0
         image1  false   true    9.2        MM/DD/YYYY TIME
         image2  true    false   9.1        MM/DD/YYYY TIME
node1
         image1  true    true    9.2        MM/DD/YYYY TIME
         image2  false   false   9.1        MM/DD/YYYY TIME
4 entries were displayed.
----
. 如果叢集僅包含兩個節點、請確認節點未保留epsilon：
+
.. 檢查節點目前是否保留epsilon：「cluster show -nodame」
+
下列範例顯示節點擁有epsilon：

+
[listing]
----
cluster1::*> cluster show -node node1

          Node: node1
          UUID: 026efc12-ac1a-11e0-80ed-0f7eba8fc313
       Epsilon: true
   Eligibility: true
        Health: true
----
.. 如果節點保留epsilon、請在節點上將epsilon標示為假、以便將epsilon傳輸至節點的合作夥伴：「cluster modify -nodelameA -epsilon fals」
.. 在合作夥伴節點上標示epsilon true、將epsilon傳輸至節點的合作夥伴：「cluster modify -nodenameB -epsilon true」


. 驗證節點是否已準備好進行還原：「System Node Reven-toe-nodame -check only true -version 9.x」
+
Check Only參數可識別還原前必須處理的任何先決條件、例如下列範例：

+
** 停用儲存容錯移轉
** 停用Snapshot原則
** 刪除升級至更新版本ONTAP 的更新版本的功能表後所建立的Snapshot複本


. 驗證是否已解決所有先決條件：「System Node Reven-toe-nodame -check only true -version 9.x」（系統節點還原至節點節點節點節點名稱-僅檢查為真版本9.x）
. 還原節點的叢集組態：「System Node Reven-toe-nodame -version 9.x」
+
-version選項是指目標版本。例如、如果您安裝並驗證的軟體ONTAP 是更新版9.1、則版本選項的正確值為9.1。

+
叢集組態會還原、然後從叢集Shell登出。

. 重新登入叢集Shell、然後切換至節點節點節點：「run -nodename」（執行節點節點節點名稱）
+
再次登入叢集Shell之後、可能需要幾分鐘的時間才能準備好接受nodesdell命令。因此、如果命令失敗、請稍候幾分鐘、然後再試一次。

. 恢復節點的檔案系統組態：「垂直轉換至9.x」
+
此命令可驗證節點的檔案系統組態是否已準備好還原、然後還原。如果發現任何先決條件、您必須解決這些條件、然後重新執行reet_to命令。

+

NOTE: 使用系統主控台來監控還原程序、顯示的詳細資料比在節點上看到的更多。

+
如果自動開機為true、則命令完成後、節點將重新開機ONTAP 至flex.

+
如果自動開機為假、則命令完成時會顯示載入器提示字元。輸入「yes」以回復、然後使用「boot_ONTAP」手動重新啟動節點。

. 節點重新開機後、請確認新軟體正在執行：「System Node image show」（系統節點映像顯示）
+
在下列範例中、image1是新ONTAP 的版本、並設為節點0上的目前版本：

+
[listing]
----
cluster1::*> system node image show
                 Is      Is                 Install
Node     Image   Default Current Version    Date
-------- ------- ------- ------- --------   -------------------
node0
         image1  true    true    X.X.X       MM/DD/YYYY TIME
         image2  false   false   Y.Y.Y      MM/DD/YYYY TIME
node1
         image1  true    false   X.X.X      MM/DD/YYYY TIME
         image2  false   true    Y.Y.Y      MM/DD/YYYY TIME
4 entries were displayed.
----
. 驗證每個節點的還原狀態是否完整：「System Node Upgrade（系統節點升級）- f還原show -nodename（還原顯示節點節點節點名稱）」
+
狀態應列示為「完成」。

. 重複 <<step-5>> 透過 <<step-17>> 在HA配對的其他節點上。
. 如果叢集僅包含兩個節點、請重新啟用叢集HA：「叢集HA modify -configured true」
. [[step -18]如果先前停用、請在兩個節點上重新啟用儲存容錯移轉：「torage容錯移轉修改節點節點節點節點名稱-啟用true」
. 重複 <<step-6>> 透過 <<step-18>> 針對MetroCluster 每個額外的HA配對和兩組叢集進行支援。

