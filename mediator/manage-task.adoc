---
permalink: mediator/manage-task.html 
sidebar: sidebar 
keywords: mediator, service, username, user name, password, change, uninstall, self-signed certificate, self signed certificate, regenerate, stop mediator service, uninstall scst 
summary: 安裝ONTAP 完「Ischimator」服務之後、您可能需要變更使用者名稱或密碼。您也可以解除安裝 ONTAP Mediator 服務。 
---
= 管理ONTAP 「協調器」服務
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
安裝ONTAP 完「Ischimator」服務之後、您可能需要變更使用者名稱或密碼。您也可以解除安裝 ONTAP Mediator 服務。



== 變更使用者名稱

.關於這些工作
這些工作是在ONTAP 安裝了《支援者》服務的Linux主機上執行。

如果無法連線至此命令、您可能需要使用完整路徑來執行命令、如下列範例所示：

`/usr/local/bin/mediator_username`

.程序
選擇下列其中一個選項來變更使用者名稱：

* 執行命令中介er_change_user、並回應下列範例所示的提示：
+
....
 [root@mediator-host ~]# mediator_change_user
 Modify the Mediator API username by entering the following values:
     Mediator API User Name: mediatoradmin
                   Password:
 New Mediator API User Name: mediator
 The account username has been modified successfully.
 [root@mediator-host ~]#
....
* 執行下列命令：
+
`MEDIATOR_USERNAME=mediator MEDIATOR_PASSWORD=mediator2 MEDIATOR_NEW_USERNAME=mediatoradmin mediator_change_user`

+
....
 [root@mediator-host ~]# MEDIATOR_USERNAME= mediator MEDIATOR_PASSWORD='mediator2' MEDIATOR_NEW_USERNAME= mediatoradmin mediator_change_user
 The account username has been modified successfully.
 [root@mediator-host ~]#
....




== 變更密碼

.關於這項工作
這項工作是在ONTAP 安裝了《支援者》服務的Linux主機上執行。

如果無法連線至此命令、您可能需要使用完整路徑來執行命令、如下列範例所示：

`/usr/local/bin/mediator_change_password`

.程序
選擇下列其中一個選項來變更密碼：

* 執行 `mediator_change_password` 命令並回應提示、如下列範例所示：
+
....
 [root@mediator-host ~]# mediator_change_password
 Change the Mediator API password by entering the following values:
    Mediator API User Name: mediatoradmin
              Old Password:
              New Password:
          Confirm Password:
 The password has been updated successfully.
 [root@mediator-host ~]#
....
* 執行下列命令：
+
`MEDIATOR_USERNAME= mediatoradmin MEDIATOR_PASSWORD=mediator1 MEDIATOR_NEW_PASSWORD=mediator2 mediator_change_password`

+
範例顯示密碼已從「 media1 」變更為「 media2 」。

+
....
 [root@mediator-host ~]# MEDIATOR_USERNAME=mediatoradmin MEDIATOR_PASSWORD=mediator1 MEDIATOR_NEW_PASSWORD=mediator2 mediator_change_password
 The password has been updated successfully.
 [root@mediator-host ~]#
....




== 停止 ONTAP Mediator 服務

若要停止 ONTAP Mediator 服務、請執行下列步驟：

.步驟
. 停止 ONTAP Mediator 。
+
`systemctl stop ontap_mediator`

. 停止 SCST 。
+
`systemctl stop mediator-scst`

. 停用 ONTAP Mediator 和 SCST 。
+
`systemctl diable ontap_mediator mediator-scst`





== 重新啟用 ONTAP Mediator 服務

若要重新啟用 ONTAP Mediator 服務、請執行下列步驟：

.步驟
. 啟用 ONTAP Mediator 和 SCST 。
+
`systemctl enable ontap_mediator mediator-scst`

. 啟動 SCST 。
+
`systemctl start mediator-scst`

. 啟動 ONTAP Mediator 。
+
`systemctl start ontap_mediator`





== 驗證 ONTAP Mediator 是否正常運作

安裝 ONTAP Mediator 之後、您應該確認 ONTAP Mediator 服務正在執行中。

.步驟
. 檢視 ONTAP Mediator 服務的狀態：
+
.. `systemctl status ontap_mediator`
+
[listing]
----
[root@scspr1915530002 ~]# systemctl status ontap_mediator

 ontap_mediator.service - ONTAP Mediator
Loaded: loaded (/etc/systemd/system/ontap_mediator.service; enabled; vendor preset: disabled)
Active: active (running) since Mon 2022-04-18 10:41:49 EDT; 1 weeks 0 days ago
Process: 286710 ExecStop=/bin/kill -s INT $MAINPID (code=exited, status=0/SUCCESS)
Main PID: 286712 (uwsgi)
Status: "uWSGI is ready"
Tasks: 3 (limit: 49473)
Memory: 139.2M
CGroup: /system.slice/ontap_mediator.service
      ├─286712 /opt/netapp/lib/ontap_mediator/pyenv/bin/uwsgi --ini /opt/netapp/lib/ontap_mediator/uwsgi/ontap_mediator.ini
      ├─286716 /opt/netapp/lib/ontap_mediator/pyenv/bin/uwsgi --ini /opt/netapp/lib/ontap_mediator/uwsgi/ontap_mediator.ini
      └─286717 /opt/netapp/lib/ontap_mediator/pyenv/bin/uwsgi --ini /opt/netapp/lib/ontap_mediator/uwsgi/ontap_mediator.ini

[root@scspr1915530002 ~]#
----
.. `systemctl status mediator-scst`
+
[listing]
----
[root@scspr1915530002 ~]# systemctl status mediator-scst
   Loaded: loaded (/etc/systemd/system/mediator-scst.service; enabled; vendor preset: disabled)
   Active: active (running) since Mon 2022-04-18 10:41:47 EDT; 1 weeks 0 days ago
  Process: 286595 ExecStart=/etc/init.d/scst start (code=exited, status=0/SUCCESS)
 Main PID: 286662 (iscsi-scstd)
    Tasks: 1 (limit: 49473)
   Memory: 1.2M
   CGroup: /system.slice/mediator-scst.service
           └─286662 /usr/local/sbin/iscsi-scstd

[root@scspr1915530002 ~]#
----


. 確認 ONTAP Mediator 服務使用的連接埠：
+
`netstat`

+
[listing]
----
[root@scspr1905507001 ~]# netstat -anlt | grep -E '3260|31784'

         tcp   0   0 0.0.0.0:31784   0.0.0.0:*      LISTEN

         tcp   0   0 0.0.0.0:3260    0.0.0.0:*      LISTEN

         tcp6  0   0 :::3260         :::*           LISTEN
----




== 手動解除安裝 SCST 以執行主機維護

若要解除安裝 SCST 、您需要用於已安裝 ONTAP Mediator 版本的 SCST tar 套件。

.步驟
. 下載適當的 SCST 套裝組合（如下表所示）並將其解壓縮。
+
[cols="50,50"]
|===


| 對於此版本 ... | 使用此 tar 套裝組合 ... 


 a| 
ONTAP Mediator 1.7
 a| 
scst-3.7.0.tar.bz2



 a| 
ONTAP Mediator 1.6
 a| 
scst-3.7.0.tar.bz2



 a| 
ONTAP Mediator 1.5
 a| 
scst-3.6.0.tar.bz2



 a| 
ONTAP Mediator 1.4
 a| 
scst-3.6.0.tar.bz2



 a| 
ONTAP Mediator 1.3
 a| 
scst-3.5.0.tar.bz2



 a| 
ONTAP Mediator 1.1
 a| 
scst-3.4.0.tar.bz2



 a| 
ONTAP Mediator 1.0
 a| 
scst-3.3.0.tar.bz2

|===
. 在 "scst" 目錄中輸入下列命令：
+
.. `systemctl stop mediator-scst`
.. `make scstadm_uninstall`
.. `make iscsi_uninstall`
.. `make usr_uninstall`
.. `make scst_uninstall`
.. `depmod`






== 手動安裝 SCST 以執行主機維護

若要手動安裝 SCST 、您需要用於已安裝 ONTAP Mediator 版本的 SCST tar 套件（請參閱 <<scst-bundle-table,上表>>）。

. 在 "scst" 目錄中輸入下列命令：
+
.. `make 2release`
.. `make scst_install`
.. `make usr_install`
.. `make iscsi_install`
.. `make scstadm_install`
.. `depmod`
.. `cp scst/src/certs/scst_module_key.der /opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/.`
.. `cp scst/src/certs/scst_module_key.der /opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/.`
.. `patch /etc/init.d/scst < /opt/netapp/lib/ontap_mediator/systemd/scst.patch`


. （選用）如果已啟用安全開機、請在重新開機之前執行下列步驟：
+
.. 決定「 scst_vdisk 」、「 scst 」和「 iscsim_scst 」模組的每個檔案名稱。
+
....
[root@localhost ~]# modinfo -n scst_vdisk
[root@localhost ~]# modinfo -n scst
[root@localhost ~]# modinfo -n iscst_scst
....
.. 決定核心版本。
+
....
[root@localhost ~]# uname -r
....
.. 使用核心簽署每個檔案。
+
....
[root@localhost ~]# /usr/src/kernels/<KERNEL-RELEASE>/scripts/sign-file \sha256 \
/opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/scst_module_key.priv \
/opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/scst_module_key.der \
_module-filename_
....
.. 使用 UEFI 韌體安裝正確的金鑰。
+
有關安裝 UEFI 金鑰的說明、請參閱：

+
`/opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/README.module-signing`

+
產生的 UEFI 金鑰位於：

+
`/opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/scst_module_key.der`



. 執行重新開機。
+
`reboot`





== 解除安裝ONTAP 「BMC Service」

.開始之前
如有必要、您可以移除ONTAP 「資訊調解器」服務。在ONTAP 您移除「內化器」服務之前、必須先中斷「內化器」與「內化器」的連線。

.關於這項工作
這項工作是在ONTAP 安裝了《支援者》服務的Linux主機上執行。

如果無法連線至此命令、您可能需要使用完整路徑來執行命令、如下列範例所示：

`/usr/local/bin/uninstall_ontap_mediator`

.步驟
. 解除安裝ONTAP 《BMC Service：
+
`uninstall_ontap_mediator`

+
....
 [root@mediator-host ~]# uninstall_ontap_mediator

 ONTAP Mediator: Self Extracting Uninstaller

 + Removing ONTAP Mediator. (Log: /tmp/ontap_mediator.GmRGdA/uninstall_ontap_mediator/remove.log)
 + Remove successful.
 [root@mediator-host ~]#
....




== 重新產生暫時自我簽署的憑證

.關於這項工作
* 您可以在安裝 ONTAP Mediator 服務的 Linux 主機上執行此工作。
* 只有在安裝 ONTAP Mediator 之後、由於主機的主機名稱或 IP 位址變更而產生的自我簽署憑證已過時時、才能執行此工作。
* 當暫時自我簽署的憑證已由信任的協力廠商憑證取代之後、您不會使用此工作來重新產生憑證。  如果沒有自我簽署的憑證、將導致此程序失敗。


.步驟
若要為目前主機重新產生新的暫時自我簽署憑證、請執行下列步驟：

. 重新啟動 ONTAP Mediator ：
+
`./make_self_signed_certs.sh overwrite`

+
[listing]
----
[root@xyz000123456 ~]# cd /opt/netapp/lib/ontap_mediator/ontap_mediator/server_config
[root@xyz000123456 server_config]# ./make_self_signed_certs.sh overwrite

Adding Subject Alternative Names to the self-signed server certificate
#
# OpenSSL example configuration file.
Generating self-signed certificates
Generating RSA private key, 4096 bit long modulus (2 primes)
..................................................................................................................................................................++++
........................................................++++
e is 65537 (0x010001)
Generating a RSA private key
................................................++++
.............................................................................................................................................++++
writing new private key to 'ontap_mediator_server.key'
-----
Signature ok
subject=C = US, ST = California, L = San Jose, O = "NetApp, Inc.", OU = ONTAP Core Software, CN = ONTAP Mediator, emailAddress = support@netapp.com
Getting CA Private Key
----

