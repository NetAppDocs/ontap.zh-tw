---
permalink: smb-admin/configure-home-directories-u-variable-task.html 
sidebar: sidebar 
keywords: 'create, home, directory, configuration, designate, share, name, variable, user, windows, dynamic, configure, configure home directories using the %u variable' 
summary: '您可以建立主目錄組態、以便使用%w變數來指定共用名稱、但您可以使用%u變數來指定主目錄共用的相對路徑。然後使用者可以使用使用Windows使用者名稱所建立的動態共用來連線到他們的主共用區、而不需要知道主目錄的實際名稱或路徑。' 
---
= 使用%u變數設定主目錄
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以建立主目錄組態、使用'%w'變數來指定共用名稱、但您可以使用'%u'變數來指定主目錄共用的相對路徑。然後使用者可以使用使用Windows使用者名稱所建立的動態共用來連線到他們的主共用區、而不需要知道主目錄的實際名稱或路徑。

.步驟
. 建立qtree以包含使用者的主目錄：「Volume qtree create -vserver vserver_name -qtree路徑qtree路徑」
. 驗證qtree是否使用正確的安全樣式：「Volume qtree show」
. 如果qtree未使用所需的安全樣式、請使用「volume qtree Security」命令變更安全樣式。
. 新增主目錄共用：`+vserver CIFS共用區create -vserver vserver -share-name %w -path %u -share-properties HomeDirectory、...]+`
+
vserver的「vserver」指定要新增搜尋路徑的CIFS型儲存虛擬機器（SVM）。

+
共享名`%w'指定主目錄共享名。當每個使用者連線至其主目錄時、就會動態建立共用名稱、格式為_windows_user_name_。

+
[NOTE]
====
您也可以將'%u'變數用於'-share-name'選項。這會建立使用對應UNIX使用者名稱的相對共用路徑。

====
+
「-path」、「%u」指定主目錄的相對路徑。當每個使用者連線至其主目錄時、會動態建立相對路徑、其格式為_Mapped_UNIX/user_name_。

+
[NOTE]
====
此選項的值也可以包含靜態元素。例如、「eng/%u」。

====
+
share-properties'、+HomeDirectory、[...]+'指定該共用的共用內容。您必須指定「HomeDirectory」值。您可以使用以逗號分隔的清單來指定其他共用屬性。

. 使用「vserver CIFS share show」命令確認共用區的組態符合所需。
. 新增主目錄搜尋路徑：「vserver CIFS主目錄搜尋路徑add -vserver vserver -path path」
+
vserver的「vserver」指定要新增搜尋路徑的CIFS型SVM。

+
"path"（路徑）指定搜尋路徑的絕對目錄路徑。

. 使用「vserver CIFS主目錄search-path show」命令、確認您已成功新增搜尋路徑。
. 如果UNIX使用者不存在、請使用「vserver services unix-usercreate」命令建立UNIX使用者。
+
[NOTE]
====
對應Windows使用者名稱的UNIX使用者名稱必須存在、才能對應使用者。

====
. 使用下列命令建立Windows使用者與UNIX使用者的名稱對應：「vserver name-mapping create -vserver vserver_name -direction win-UNIX -priority integerity -tPatterns_user_name -replacement unix_user_name'
+
[NOTE]
====
如果已存在將Windows使用者對應至UNIX使用者的名稱對應、則不必執行對應步驟。

====
+
Windows使用者名稱會對應至對應的UNIX使用者名稱。當Windows使用者連線至其主目錄共用時、他們會連線至動態建立的主目錄、其中共用名稱對應於Windows使用者名稱、但不知道該目錄名稱對應於UNIX使用者名稱。

. 對於擁有主目錄的使用者、請在qtree或指定包含主目錄的磁碟區中建立對應的目錄。
+
例如、如果您建立的qtree路徑為「/vol/vol1/users'」、且您要建立目錄為「unixuser1」之使用者的對應UNIX使用者名稱為「unixuser1」、您就會建立一個路徑如下的目錄：「/vol/vol1/users/unixuser1」。

+
如果您建立的磁碟區名稱為「home1」、安裝於「/hhome1」、您可以建立一個路徑如下的目錄：「/hhome1/unixuser1」。

. 確認使用者可以透過對應磁碟機或使用UNC路徑連線、成功連線至主共用區。
+
例如、如果使用者mydomain\user1對應到UNIX使用者unixuser1、並想要連線到在步驟10中建立的SVM VS1目錄、則使用者1會使用UNC路徑「\VS1\user1」連線。



下列範例中的命令會以下列設定建立主目錄組態：

* 共享區名稱為%W.
* 相對主目錄路徑為%u
* 用於包含主目錄的搜尋路徑「/hhome1」是設定為UNIX安全性樣式的Volume。
* 組態是在SVM VS1上建立。


當使用者從Windows主機或Windows和UNIX主機存取其主目錄時、您可以使用此類型的主目錄組態、而檔案系統管理員則使用UNIX使用者和群組來控制檔案系統的存取。

[listing]
----
cluster::> vserver cifs share create -vserver vs1 -share-name %w -path %u ‑share-properties oplocks,browsable,changenotify,homedirectory

cluster::> vserver cifs share show -vserver vs1 -share-name %u

                      Vserver: vs1
                        Share: %w
     CIFS Server NetBIOS Name: VS1
                         Path: %u
             Share Properties: oplocks
                               browsable
                               changenotify
                               homedirectory
           Symlink Properties: enable
      File Mode Creation Mask: -
 Directory Mode Creation Mask: -
                Share Comment: -
                    Share ACL: Everyone / Full Control
File Attribute Cache Lifetime: -
                  Volume Name: -
                Offline Files: manual
Vscan File-Operations Profile: standard

cluster::> vserver cifs home-directory search-path add -vserver vs1 ‑path /home1

cluster::> vserver cifs home-directory search-path show -vserver vs1
Vserver     Position Path
----------- -------- -----------------
vs1         1        /home1

cluster::> vserver name-mapping create -vserver vs1 -direction win-unix ‑position 5 -pattern user1 -replacement unixuser1

cluster::> vserver name-mapping show -pattern user1
Vserver        Direction Position
-------------- --------- --------
vs1            win-unix  5        Pattern: user1
                              Replacement: unixuser1
----
xref:create-home-directory-config-w-d-variables-task.adoc[使用%w和%d變數建立主目錄組態]

xref:home-directory-config-concept.adoc[其他主目錄組態]

xref:display-user-home-directory-path-task.adoc[顯示SMB使用者主目錄路徑的相關資訊]
