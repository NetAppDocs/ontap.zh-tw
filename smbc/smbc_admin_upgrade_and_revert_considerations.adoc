---
sidebar: sidebar 
permalink: smbc/smbc_admin_upgrade_and_revert_considerations.html 
keywords: upgrade, revert, snapmirror active sync 
summary: 升級或還原 ONTAP 會影響您的 SM-BC 關係、尤其是移轉至 ONTAP 9.8 或更新版本或 9.7 及更早版本時。 
---
= 使用 SM-BC 升級及還原 ONTAP
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
從 ONTAP 9.8 開始、即可支援 SnapMirror 業務持續運作（ SM-BC ）。根據您要升級或還原的 ONTAP 版本、升級和還原 ONTAP 叢集對 SM-BC 關係有影響。



== 升級ONTAP

您必須先將來源叢集和目的地叢集上的所有節點升級ONTAP 為「版本9.8」或更新版本、才能設定及使用SMBC。
link:link:../upgrade/index.html["ONTAP 叢集上的升級軟體"]


NOTE: 。 `snapmirror quiesce` 和 `snampirror resume` SM-BC 不支援命令。

當您將叢集從 9.8 或 9.9.1 升級至 9.10.1 時、 ONTAP 會在來源和目的地建立新的 SMBC 關係一致性群組。您可以在 System Manager 中的「 ** 一致性群組 ** 」選項下管理這些項目、或使用 ONTAP REST API 搭配一致性群組端點。



== 從 ONTAP 9.10.1 還原至 ONTAP 9.9.1

若要將關係從9.10.1還原為9.9.1、則必須刪除SMBC關係、接著刪除9.10.1一致性群組執行個體。無法刪除具有作用中 SM-BC 關係的一致性群組。任何先前在9.9.1或更早版本中與另一個Smart Container或Enterprise App相關聯的更新至9.10.1的版次、將不再與還原相關聯。FlexVol刪除一致性群組不會刪除組成磁碟區或磁碟區精細快照。請參閱 link:../consistency-groups/delete-task.html["刪除一致性群組"] 如需 ONTAP 9.10.1 及更新版本中此工作的詳細資訊、請參閱。



== 從 ONTAP 9.8 回復至 ONTAP 9.7


NOTE: SMBC不支援混合ONTAP 式的仰賴於混合式的NetApp 9.7 ONTAP 和更新的支援。

當您從ONTAP 還原到ONTAP 更新9.7時、您必須注意下列事項：

* 如果叢集主控 SM-BC 目的地、則除非關係中斷並刪除、否則不允許還原至 ONTAP 9.7 。
* 如果叢集主控 SM-BC 來源、則在關係解除之前、不允許還原至 ONTAP 9.7 。
* 所有使用者建立的自訂SMBC SnapMirror原則、都必須先刪除、才能還原ONTAP 至還原為版本9.7。


若要符合這些要求、請參閱 link:smbc_admin_removing_an_smbc_configuration.html["移除SM至BC組態"]。

.步驟
. 從SMBC關係中的其中一個叢集執行還原檢查：
+
`cluster::*> system node revert-to -version 9.7 -check-only`

+
範例：

+
....
cluster::*> system node revert-to -version 9.7 -check-only
Error: command failed: The revert check phase failed. The following issues must be resolved before revert can be completed. Bring the data LIFs down on running vservers. Command to list the running vservers: vserver show -admin-state running Command to list the data LIFs that are up: network interface show -role data -status-admin up Command to bring all data LIFs down: network interface modify {-role data} -status-admin down
Disable snapshot policies.
    Command to list snapshot policies: "snapshot policy show".
    Command to disable snapshot policies: "snapshot policy modify -vserver
   * -enabled false"

   Break off the initialized online data-protection (DP) volumes and delete
   Uninitialized online data-protection (DP) volumes present on the local
   node.
    Command to list all online data-protection volumes on the local node:
   volume show -type DP -state online -node <local-node-name>
    Before breaking off the initialized online data-protection volumes,
   quiesce and abort transfers on associated SnapMirror relationships and
   wait for the Relationship Status to be Quiesced.
    Command to quiesce a SnapMirror relationship: snapmirror quiesce
    Command to abort transfers on a SnapMirror relationship: snapmirror
   abort
    Command to see if the Relationship Status of a SnapMirror relationship
   is Quiesced: snapmirror show
    Command to break off a data-protection volume: snapmirror break
    Command to break off a data-protection volume which is the destination
   of a SnapMirror relationship with a policy of type "vault": snapmirror
   break -delete-snapshots
    Uninitialized data-protection volumes are reported by the "snapmirror
   break" command when applied on a DP volume.
    Command to delete volume: volume delete

   Delete current version snapshots in advanced privilege level.
    Command to list snapshots: "snapshot show -fs-version 9.8"
    Command to delete snapshots: "snapshot prepare-for-revert -node
   <nodename>"

   Delete all user-created policies of the type active-strict-sync-mirror
   and active-sync-mirror.
   The command to see all active-strict-sync-mirror and active-sync-mirror
   type policies is:
    snapmirror policy show -type
   active-strict-sync-mirror,active-sync-mirror
   The command to delete a policy is :
    snapmirror policy delete -vserver <SVM-name> -policy <policy-name>
....


如需還原叢集的相關資訊、請參閱 link:../revert/index.html["還原ONTAP"]。
