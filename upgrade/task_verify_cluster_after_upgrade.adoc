---
permalink: upgrade/task_verify_cluster_after_upgrade.html 
sidebar: sidebar 
keywords: ontap, upgrade, upgrade, verify, status, health, post, after 
summary: 升級之後、您應該確認叢集。 
---
= 升級後的叢集驗證
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
升級之後、您應該確認叢集版本、叢集健全狀況和儲存健全狀況。

.開始之前

NOTE: 如果您使用MetroCluster 的是SFC組態、您也需要確認叢集已啟用自動非計畫性切換功能。



== 驗證叢集版本

在所有HA配對升級之後、您必須使用version命令來驗證所有節點是否都在執行目標版本。

叢集版本是ONTAP 叢集內任何節點上執行的最低版本的功能。如果叢集版本不是目標ONTAP 版本的版本、您可以升級叢集。

. 驗證叢集版本是否為目標ONTAP 版本的發行版本：
+
「分度」

. 如果叢集版本不是目標ONTAP 版本的版本、您可以驗證所有節點的升級狀態：
+
「系統節點升級回復顯示」





== 驗證叢集健全狀況

[role="lead"]
升級叢集之後、您應該確認節點狀況良好且符合參與叢集的資格、而且叢集已達到仲裁數。

. 驗證叢集中的節點是否處於線上狀態、並符合參加叢集的資格：
+
「叢集展示」

+
[listing]
----
cluster1::> cluster show
Node                  Health  Eligibility
--------------------- ------- ------------
node0                 true    true
node1                 true    true
----
+
如果有任何節點不健全或不符合資格、請檢查EMS記錄是否有錯誤、並採取修正行動。

. 將權限層級設為進階：
+
"進階權限"

+
輸入「y」以繼續。

. 驗證每個RDB程序的組態詳細資料。
+
** 每個節點的關聯式資料庫時期和資料庫時期應相符。
** 所有節點的每個環仲裁主機都應該相同。
+
請注意、每個振鈴都可能有不同的仲裁主機。

+
|===


| 若要顯示此RDB程序... | 輸入此命令... 


 a| 
管理應用程式
 a| 
「叢集環顯示-unitname mgmt」



 a| 
Volume位置資料庫
 a| 
「叢集環顯示-unitname VLDB」



 a| 
虛擬介面管理程式
 a| 
「叢集環show -unitname vifmgr'



 a| 
SAN管理精靈
 a| 
「叢集環show -unitname bcomd」

|===
+
此範例顯示Volume位置資料庫程序：



+
[listing]
----
cluster1::*> cluster ring show -unitname vldb
Node      UnitName Epoch    DB Epoch DB Trnxs Master    Online
--------- -------- -------- -------- -------- --------- ---------
node0     vldb     154      154      14847    node0     master
node1     vldb     154      154      14847    node0     secondary
node2     vldb     154      154      14847    node0     secondary
node3     vldb     154      154      14847    node0     secondary
4 entries were displayed.
----
. 如果您是在SAN環境中運作、請確認每個節點都位於SAN仲裁中：「事件記錄檔顯示嚴重性資訊-message-name scsimble.*」
+
每個節點的最新scsimblet事件訊息應指出SCSI刀鋒處於仲裁狀態。

+
[listing]
----
cluster1::*> event log show  -severity informational -message-name scsiblade.*
Time             Node       Severity       Event
---------------  ---------- -------------- ---------------------------
MM/DD/YYYY TIME  node0      INFORMATIONAL  scsiblade.in.quorum: The scsi-blade ...
MM/DD/YYYY TIME  node1      INFORMATIONAL  scsiblade.in.quorum: The scsi-blade ...
----


.相關資訊
link:../system-admin/index.html["系統管理"]



== 確認已啟用自動非計畫性切換

升級叢集之後、您應該確認已啟用自動非計畫性切換。

.關於這項工作

NOTE: 此程序僅適用於MetroCluster 不含功能的FC組態。如果您使用MetroCluster 的是一套靜態IP組態、請跳過此程序。

.步驟
. 檢查是否已啟用自動非計畫性切換：
+
《不看》MetroCluster

+
如果啟用自動非計畫性切換、命令輸出中會出現下列陳述：

+
[listing]
----
AUSO Failure Domain  auso-on-cluster-disaster
----
. 如果未出現該陳述、請啟用自動非計畫性切換：
+
《MetroCluster 關於在叢集上發生auso-on叢集災難的迴轉自動切換失敗網域》

. 重複步驟1、確認已啟用自動非計畫性切換。




== 驗證儲存設備健全狀況

升級叢集之後、您應該確認磁碟、集合體和磁碟區的狀態。

. 驗證磁碟狀態：
+
|===


| 若要檢查... | 執行此動作... 


 a| 
中斷的磁碟
 a| 
.. 顯示任何毀損的磁碟：
+
「torage disk show -state dis中斷」

.. 移除或更換任何損壞的磁碟。




 a| 
正在進行維護或重建的磁碟
 a| 
.. 顯示任何處於維護、擱置或重建狀態的磁碟：
+
「torage disk show -stance maintenance |待發| remisten構造」

.. 請等待維護或重建作業完成後再繼續。


|===
. 顯示實體與邏輯儲存設備的狀態（包括儲存集合體）、以確認所有集合體均處於線上狀態：
+
「torage Aggregate show -state！online」

+
此命令會顯示_非_線上的集合體。執行重大升級或還原之前和之後、所有集合體都必須處於線上狀態。

+
[listing]
----
cluster1::> storage aggregate show -state !online
There are no entries matching your query.
----
. 顯示任何非連線的磁碟區、以驗證所有磁碟區是否都在線上：
+
「Volume show -state！online」

+
執行重大升級或還原之前和之後、所有磁碟區都必須處於線上狀態。

+
[listing]
----
cluster1::> volume show -state !online
There are no entries matching your query.
----
. 確認沒有不一致的磁碟區：
+
「Volume show -is不一致true」

+
請參閱知識庫文章 link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Storage_Software/ONTAP_OS/Volume_Showing_WAFL_Inconsistent["顯示WAFL 不一致的Volume"] 如何解決不一致的磁碟區。



.相關資訊
link:../disks-aggregates/index.html["磁碟與Aggregate管理"]
