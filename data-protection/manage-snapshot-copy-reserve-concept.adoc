---
permalink: data-protection/manage-snapshot-copy-reserve-concept.html 
sidebar: sidebar 
keywords: manage, snapshot, copy, reserve, increase, protected files 
summary: 'Snapshot 保留空間會預留一定百分比的磁碟空間供快照使用，預設為 5% 。由於快照在快照保留空間用盡時會佔用作用中檔案系統的空間，因此您可能需要視需要增加快照保留空間。或者，您也可以在保留空間已滿時自動刪除快照。' 
---
= 瞭解如何管理 ONTAP 快照保留區
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
_snapshot reserve 會預留一定百分比的磁碟空間供快照使用，預設為 5% 。由於快照在快照保留空間用盡時會佔用作用中檔案系統的空間，因此您可能需要視需要增加快照保留空間。或者，您也可以在保留空間已滿時自動刪除快照。



== 何時增加快照保留

在決定是否增加快照保留時，請務必記住，快照記錄只會在上次快照建立後變更檔案。只有在修改或刪除作用中檔案系統中的區塊時、才會佔用磁碟空間。

這表示檔案系統的變更率是決定快照所用磁碟空間量的關鍵因素。無論您建立多少個快照，如果使用中的檔案系統尚未變更，快照都不會佔用磁碟空間。

例如，包含資料庫交易記錄的 FlexVol volume 可能會有高達 20% 的快照保留空間，以因應其較高的變更率。您不僅想要建立更多快照來擷取更頻繁的資料庫更新，還想要擁有更大的快照保留空間來處理快照所佔用的額外磁碟空間。

[TIP]
====
快照包含指向區塊的指標，而非區塊的複本。您可以將指標視為區塊上的「宣告」： ONTAP 「保留」區塊，直到刪除快照為止。

====
image:how-snapshots-consume-disk-space.gif["快照佔用的磁碟空間"]



== 刪除受保護檔案的方式、會導致檔案空間比預期要小

即使刪除使用該區塊的檔案，快照仍會指向某個區塊。這說明了為什麼用盡快照保留空間可能會導致相反的直覺結果，導致刪除整個檔案系統所產生的可用空間比檔案系統佔用的空間更少。

請考慮下列範例。刪除任何檔案之前、 `df` 命令輸出如下所示：

[listing]
----

Filesystem          kbytes  used    avail  capacity
/vol/vol0/          3000000 3000000 0       100%
/vol/vol0/.snapshot 1000000 500000  500000   50%
----
刪除整個檔案系統並建立磁碟區快照之後，命令會 `df`產生下列輸出：

[listing]
----

Filesystem          kbytes  used    avail  capacity
/vol/vol0/          3000000 2500000 500000   83%
/vol/vol0/.snapshot 1000000 3500000 0       350%
----
如輸出所示，除了刪除前使用的 0.5 GB 之外，目前快照也會使用先前使用中檔案系統所使用的全部 3 GB 。

由於快照所使用的磁碟空間現在已超過快照保留空間，因此 2.5 GB 的「空間」會溢入保留給作用中檔案的空間，因此您有 0.5 GB 的可用空間可容納您合理預期需要 3 GB 的檔案。

如需有關本程序中所述命令link:https://docs.netapp.com/us-en/ontap-cli/["指令參考資料ONTAP"^]的詳細資訊，請參閱。
