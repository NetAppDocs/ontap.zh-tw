---
permalink: data-protection/convert-snapmirror-version-flexible-task.html 
sidebar: sidebar 
keywords: convert, exist, dp-type, relationship, xdp 
summary: 您可以輕鬆地將現有的DP類型關係轉換成XDP、以善用靈活版本的SnapMirror。 
---
= 將現有的DP類型關係轉換為XDP
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以輕鬆地將現有的DP類型關係轉換成XDP、以善用靈活版本的SnapMirror。

.關於這項工作
* SnapMirror不會自動將現有的DP類型關係轉換為XDP。若要轉換關係、您必須中斷並刪除現有的關係、建立新的XDP關係、然後重新同步關係。如需背景資訊、請參閱 link:version-flexible-snapmirror-default-concept.html["XDP取代DP做為SnapMirror預設值"]。
* 規劃轉換時、您應該注意、XDP SnapMirror關係的背景準備和資料倉儲階段可能需要很長時間。SnapMirror關係報告長時間處於「準備」狀態、並不罕見。


[NOTE]
====
將SnapMirror關係類型從DP轉換為XDP之後、與空間相關的設定（例如自動調整大小和空間保證）將不再複寫到目的地。

====
.步驟
. 從目的地叢集、確定SnapMirror關係為DP類型、鏡射狀態為Snapmirror、關係狀態為閒置、關係健全：
+
「napmirror show -dite-path _svm:volume（napmirror show -dite-path _svm:volume）」|「叢集：//Svm/volume（叢集）」

+
以下範例顯示「shnapmirror show」命令的輸出：

+
[listing]
----
cluster_dst::>snapmirror show -destination-path svm_backup:volA_dst

Source Path: svm1:volA
Destination Path: svm_backup:volA_dst
Relationship Type: DP
SnapMirror Schedule: -
Tries Limit: -
Throttle (KB/sec): unlimited
Mirror State: Snapmirrored
Relationship Status: Idle
Transfer Snapshot: -
Snapshot Progress: -
Total Progress: -
Snapshot Checkpoint: -
Newest Snapshot: snapmirror.10af643c-32d1-11e3-954b-123478563412_2147484682.2014-06-27_100026
Newest Snapshot Timestamp: 06/27 10:00:55
Exported Snapshot: snapmirror.10af643c-32d1-11e3-954b-123478563412_2147484682.2014-06-27_100026
Exported Snapshot Timestamp: 06/27 10:00:55
Healthy: true
----
+
[NOTE]
====
您可能會發現保留一份「napmirror show」命令輸出的複本、以便追蹤現有的關係設定、這點很有幫助。

====
. 從來源和目的地磁碟區、確保兩個磁碟區都有一個通用的Snapshot複本：
+
「Volume Snapshot show -vserver _svm_-volume _volume _」

+
以下範例顯示了souce和目的地磁碟區的「Volume Snapshot show」輸出：

+
[listing]
----
cluster_src:> volume snapshot show -vserver vsm1 -volume volA
---Blocks---
Vserver Volume Snapshot State Size Total% Used%
-------- ------- ------------------------------- -------- -------- ------ -----
svm1 volA
weekly.2014-06-09_0736 valid 76KB 0% 28%
weekly.2014-06-16_1305 valid 80KB 0% 29%
daily.2014-06-26_0842 valid 76KB 0% 28%
hourly.2014-06-26_1205 valid 72KB 0% 27%
hourly.2014-06-26_1305 valid 72KB 0% 27%
hourly.2014-06-26_1405 valid 76KB 0% 28%
hourly.2014-06-26_1505 valid 72KB 0% 27%
hourly.2014-06-26_1605 valid 72KB 0% 27%
daily.2014-06-27_0921 valid 60KB 0% 24%
hourly.2014-06-27_0921 valid 76KB 0% 28%
snapmirror.10af643c-32d1-11e3-954b-123478563412_2147484682.2014-06-27_100026
valid 44KB 0% 19%
11 entries were displayed.


cluster_dest:> volume snapshot show -vserver svm_backup -volume volA_dst
---Blocks---
Vserver Volume Snapshot State Size Total% Used%
-------- ------- ------------------------------- -------- -------- ------ -----
svm_backup volA_dst
weekly.2014-06-09_0736 valid 76KB 0% 30%
weekly.2014-06-16_1305 valid 80KB 0% 31%
daily.2014-06-26_0842 valid 76KB 0% 30%
hourly.2014-06-26_1205 valid 72KB 0% 29%
hourly.2014-06-26_1305 valid 72KB 0% 29%
hourly.2014-06-26_1405 valid 76KB 0% 30%
hourly.2014-06-26_1505 valid 72KB 0% 29%
hourly.2014-06-26_1605 valid 72KB 0% 29%
daily.2014-06-27_0921 valid 60KB 0% 25%
hourly.2014-06-27_0921 valid 76KB 0% 30%
snapmirror.10af643c-32d1-11e3-954b-123478563412_2147484682.2014-06-27_100026
----
. 若要確保在轉換期間不會執行排程的更新、請停止現有的DP類型關係：
+
"napmirror quiesce -path _svm:volume（napmirror靜止-source-path _svm:volume）_cluster：//svm/volume（虛擬磁碟區/磁碟區）"、... -destination-path _svm:volume _|_cluster：//svm/volume _、...

+
如需完整的命令語法、請參閱手冊頁。

+
[NOTE]
====
您必須從目的地SVM或目的地叢集執行此命令。

====
+
以下範例會使來源磁碟區「Vola」與「shvm_backup」上的目的地磁碟區「Vola_dst」之間的關係靜止不動：

+
[listing]
----
cluster_dst::> snapmirror quiesce -destination-path svm_backup:volA_dst
----
. 打破現有的DP類型關係：
+
"napmirror中斷-destination-path _svm:volume？|叢集：//Svm/volume、...

+
如需完整的命令語法、請參閱手冊頁。

+
[NOTE]
====
您必須從目的地SVM或目的地叢集執行此命令。

====
+
以下範例打破了「svm1」上的來源磁碟區「Vola」與「shvm_backup」上的目的地磁碟區「Vola_dst」之間的關係：

+
[listing]
----
cluster_dst::> snapmirror break -destination-path svm_backup:volA_dst
----
. 如果在目的地磁碟區上啟用了自動刪除Snapshot複本、請停用它：
+
「Volume Snapshot autodete modify -vserver _Svm_-volume _volume _-enablete」

+
以下範例停用目的地磁碟區「Vola_dst」上的Snapshot複本自動刪除功能：

+
[listing]
----
cluster_dst::> volume snapshot autodelete modify -vserver svm_backup -volume volA_dst -enabled false
----
. 刪除現有的DP類型關係：
+
「napmirror DELETE -destination-path _svm:volume」（napmirror刪除- dite-path _svm:volume）|「叢集」：//Svm/volume、...」

+
如需完整的命令語法、請參閱手冊頁。

+
[NOTE]
====
您必須從目的地SVM或目的地叢集執行此命令。

====
+
以下範例刪除了來源磁碟區「Vola」（在「svm1」上）與目的地磁碟區「Vola_dst」（在「shvm_backup」上）之間的關係：

+
[listing]
----
cluster_dst::> snapmirror delete -destination-path svm_backup:volA_dst
----
. 您可以使用從「shnapmirror show（快照鏡像顯示）命令中保留的輸出來建立新的XDP類型關係：
+
"napmirror create -source-path _svm:volume（napmirror create -source-path _svm:volume）_cluster（叢集）：//SVM/volume（磁碟區）"、... -destination-path _svm:Volume _|_cluster：//svm/volume _、... 鍵入XDP -schedule _schedule_-policy _policy

+
新關係必須使用相同的來源和目的地Volume。如需完整的命令語法、請參閱手冊頁。

+
[NOTE]
====
您必須從目的地SVM或目的地叢集執行此命令。

====
+
以下範例使用預設的「鏡射AllSnapshots」原則、在來源磁碟區「Vola」與「svm1」上的目的地磁碟區「Vola_dst」之間建立SnapMirror DR關係：

+
[listing]
----
cluster_dst::> snapmirror create -source-path svm1:volA -destination-path svm_backup:volA_dst
-type XDP -schedule my_daily -policy MirrorAllSnapshots
----
. 重新同步來源與目的地磁碟區：
+
"napmirror resSync -source-path _Svm:Volume _|_cluster：//SVM/Volume _、... -destination-path _svm:volume _|_cluster：//svm/volume _、...

+
如需完整的命令語法、請參閱手冊頁。

+
[NOTE]
====
您必須從目的地SVM或目的地叢集執行此命令。雖然重新同步不需要基準傳輸、但這可能很耗時。您可能想要在非尖峰時間執行重新同步。

====
+
以下範例重新同步來源磁碟區「Vola」（在「svm1」上）與目的地磁碟區「Vola_dst」（在「shvm_backup」上）之間的關係：

+
[listing]
----
cluster_dst::> snapmirror resync -source-path svm1:volA -destination-path svm_backup:volA_dst
----
. 如果停用自動刪除Snapshot複本、請重新啟用：
+
「Volume Snapshot autod刪除modify -vserver _Svm_-volume _volume _-enabl用量true」



.完成後
. 使用「napmirror show」命令來驗證SnapMirror關係是否已建立。如需完整的命令語法、請參閱手冊頁。
. SnapMirror XDP目的地磁碟區開始更新SnapMirror原則所定義的Snapshot複本之後、您就可以使用來源叢集的「快照鏡射list-destinations」命令輸出來顯示新的SnapMirror XDP關係。

