---
permalink: san-admin/enable-space-allocation-scsi-thin-provisioned-luns-task.html 
sidebar: sidebar 
keywords: enable, space, allocation, scsi, thinly, provisioned luns 
summary: 如果您將空間分配選項設為啟用、ONTAP 則當磁碟區空間不足、且磁碟區中的LUN無法接受寫入時、將會通知主機。此選項也可讓ONTAP 支援功能在主機刪除資料時自動回收空間。 
---
= 為精簡配置的SCSI LUN啟用空間分配
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果您的主機支援 SCSI 精簡配置、您可以在 ONTAP 中啟用 SCSI 精簡配置 LUN 的空間分配。  啟用空間分配時、 ONTAP 會在磁碟區空間不足且磁碟區中的 LUN 無法接受寫入時通知主機。當主機刪除資料時、 ONTAP 也會自動回收空間。

在不支援SCSI精簡配置的主機上、當包含LUN的磁碟區空間不足且無法自動擴充時ONTAP 、無法將LUN離線。在支援 SCSI 精簡配置的主機上、當 LUN 空間不足時、 ONTAP 不會將其離線。LUN會以唯讀模式保持線上狀態、並通知主機LUN不再接受寫入作業。

此外、當在支援 SCSI 精簡配置的主機上刪除資料時、主機端空間管理會識別主機檔案系統上刪除的資料區塊、並自動發出一或多個資料區塊 `SCSI UNMAP` 釋放儲存系統上對應區塊的命令。

.開始之前
若要啟用空間分配、您的主機必須支援 SCSI 精簡配置。SCSI 精簡配置使用 SCSI SBC-3 標準中定義的邏輯區塊資源配置。只有支援此標準的主機才能在ONTAP 支援中使用SCSI精簡配置。

啟用空間分配時、下列主機目前支援SCSI精簡配置：

* Citrix XenServer 6.5 及更新版本
* ESXi 5.0 及更新版本
* Oracle Linux 6.2 UEK 核心或更新版本
* RHEL 6.2 及更新版本
* SLES11 及更新版本
* Solaris 11.1 及更新版本
* Windows


.關於這項工作
依預設、所有 LUN 的空間分配都會停用。您必須將 LUN 離線才能啟用空間分配、然後您必須在主機上執行探索、主機才能識別已啟用空間分配。

.步驟
. 使LUN離線。
+
[source, cli]
----
lun modify -vserver vserver_name -volume volume_name -lun lun_name -state offline
----
. 啟用空間分配：
+
[source, cli]
----
lun modify -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -space-allocation enabled
----
. 確認已啟用空間分配：
+
[source, cli]
----
lun show -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -fields space-allocation
----
. 使LUN上線：
+
[source, cli]
----
lun modify -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -state online
----
. 在主機上、重新掃描所有磁碟、以確保變更為 `-space-allocation` 已正確探索選項。

